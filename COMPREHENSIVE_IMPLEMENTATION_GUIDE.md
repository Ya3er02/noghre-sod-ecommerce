# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¬Ø§Ù…Ø¹ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ÛŒâ€ŒÙ‡Ø§

## ğŸ“ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ù…Ø¹Ø±ÙÛŒ](#Ù…Ø¹Ø±ÙÛŒ)
2. [Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§](#Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§)
3. [Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ](#Ù†ØµØ¨-Ùˆ-Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ)
4. [Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ](#Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ-Ø§Ù…Ù†ÛŒØªÛŒ)
5. [Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡â€ŒØ³Ø§Ø²ÛŒ](#Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡â€ŒØ³Ø§Ø²ÛŒ)
6. [ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ API Ù‚ÛŒÙ…Øª](#ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ-api-Ù‚ÛŒÙ…Øª)
7. [Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ](#Ù‡ÙˆØ´-Ù…ØµÙ†ÙˆØ¹ÛŒ)
8. [PWA](#pwa)
9. [ØªØ³Øª Ùˆ Ø±ÙØ¹ Ø¹ÛŒØ¨](#ØªØ³Øª-Ùˆ-Ø±ÙØ¹-Ø¹ÛŒØ¨)

---

## Ù…Ø¹Ø±ÙÛŒ

Ø§ÛŒÙ† Ø¨Ø±Ù†Ú† Ø´Ø§Ù…Ù„ Ø¨Ù‡Ø¨ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ù…Ø¹ Ø¯Ø± ØªÙ…Ø§Ù… Ø¬Ù†Ø¨Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ù„ØªÙØ±Ù… Ù†Ù‚Ø±Ù‡ Ø³ÙˆØ¯ Ø§Ø³Øª:

### ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯:

- âœ… **Ø§Ù…Ù†ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡**: MFA, Rate Limiting, Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
- âœ… **Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡**: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ ÙØ§Ø±Ø³ÛŒØŒ Ø¹Ø±Ø¨ÛŒØŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
- âœ… **Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ**: Ø§ØªØµØ§Ù„ Ø¨Ù‡ APIÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø± Ù‚ÛŒÙ…Øª Ù†Ù‚Ø±Ù‡
- âœ… **Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ**: ØªØ­Ù„ÛŒÙ„ Ù…Ø­ØµÙˆÙ„ØŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
- âœ… **PWA**: Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÙˆØ¨ Ù‚Ø§Ø¨Ù„ Ù†ØµØ¨
- âœ… **Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Performance**: Code splitting, Caching, CDN

---

## Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

### Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:

```bash
# Node.js v20 or higher
node --version  # v20.0.0+

# Bun (Package Manager)
curl -fsSL https://bun.sh/install | bash

# Docker (optional, for containerization)
docker --version
```

### API Keys Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:

1. **OpenAI API Key** - Ø¨Ø±Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
2. **Metals-API Key** - Ø¨Ø±Ø§ÛŒ Ù‚ÛŒÙ…Øª Ù†Ù‚Ø±Ù‡
3. **Metal Price API Key** - Ø¨Ø±Ø§ÛŒ Ù‚ÛŒÙ…Øª Ù†Ù‚Ø±Ù‡ (Ù…Ù†Ø¨Ø¹ Ø¯ÙˆÙ…)
4. **Clerk API Key** - Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

---

## Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 1. Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ú†

```bash
git clone https://github.com/Ya3er02/noghre-sod-ecommerce.git
cd noghre-sod-ecommerce
git checkout feature/comprehensive-improvements
```

### 2. Ù†ØµØ¨ Dependencies

```bash
# Backend
cd backend
bun install

# Frontend
cd ../frontend
bun install

# Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
bun add speakeasy qrcode express-rate-limit helmet
bun add i18next react-i18next i18next-browser-languagedetector i18next-http-backend
bun add openai axios
```

### 3. Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Environment Variables

#### Backend `.env`:

```env
# Database
DATABASE_URL="postgresql://user:pass@localhost:5432/noghresood"

# Encryption
ENCRYPTION_KEY="YOUR_32_BYTE_HEX_KEY_HERE"
OTP_SECRET="YOUR_OTP_SECRET_HERE"

# APIs
OPENAI_API_KEY="sk-..."
METALS_API_KEY="YOUR_METALS_API_KEY"
METAL_PRICE_API_KEY="YOUR_METAL_PRICE_API_KEY"

# Authentication
CLERK_SECRET_KEY="sk_..."

# Redis (for caching)
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_PASSWORD=""

# Environment
NODE_ENV="development"
PORT="4000"
```

#### Frontend `.env`:

```env
VITE_API_URL="http://localhost:4000"
VITE_CLERK_PUBLISHABLE_KEY="pk_..."
VITE_APP_NAME="Ù†Ù‚Ø±Ù‡ Ø³ÙˆØ¯"
```

### 4. ØªÙˆÙ„ÛŒØ¯ Encryption Key

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 5. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Development

```bash
# Terminal 1: Backend
cd backend
encore run

# Terminal 2: Frontend
cd frontend
bun run dev
```

Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯: `http://localhost:5173`

---

## Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

### 1. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Rate Limiting

```typescript
// backend/index.ts
import { apiLimiter, loginLimiter, securityHeaders } from './auth/middleware/security';
import cors from 'cors';

const app = express();

// Security Headers
app.use(securityHeaders);

// CORS
app.use(cors(corsOptions));

// Rate Limiting
app.use('/api/', apiLimiter);
app.use('/api/auth/login', loginLimiter);
```

### 2. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ MFA

```typescript
// Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
const { secret, qrCode, backupCodes } = await mfaService.generateMFASecret(
  userId,
  userEmail
);

// Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
await db.users.update({
  where: { id: userId },
  data: {
    mfaSecret: encryption.encrypt(secret),
    mfaBackupCodes: backupCodes.map(code => encryption.hash(code)),
    mfaEnabled: false, // Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¹Ø¯Ø§Ù‹ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
  },
});
```

### 3. Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§

```typescript
// models/user.entity.ts
import { encryptionTransformer } from '../db/encryption.service';

@Entity()
export class User {
  @Column({ 
    type: 'text',
    transformer: encryptionTransformer 
  })
  nationalId: string; // Ø´Ù…Ø§Ø±Ù‡ Ù…Ù„ÛŒ

  @Column({ 
    type: 'text',
    transformer: encryptionTransformer 
  })
  bankAccount: string; // Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ
}
```

---

## Ú†Ù†Ø¯Ø²Ø¨Ø§Ù†Ù‡â€ŒØ³Ø§Ø²ÛŒ

### 1. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ i18n

```typescript
// frontend/main.tsx
import './lib/i18n/config';
import { Suspense } from 'react';

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <YourApp />
    </Suspense>
  );
}
```

### 2. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Components

```typescript
import { useTranslation } from 'react-i18next';
import { useCurrencyFormatter } from '../lib/formatters';

function ProductCard({ product }) {
  const { t } = useTranslation();
  const { formatCurrency } = useCurrencyFormatter();

  return (
    <div>
      <h3>{product.name}</h3>
      <p>{formatCurrency(product.price)}</p>
      <button>{t('actions.add_to_cart')}</button>
    </div>
  );
}
```

### 3. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

```json
// public/locales/fa/product.json
{
  "silver_price_live": "Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù†Ù‚Ø±Ù‡",
  "per_ounce": "Ù‡Ø± Ø§ÙˆÙ†Ø³",
  "per_gram": "Ù‡Ø± Ú¯Ø±Ù…",
  "change_24h": "ØªØºÛŒÛŒØ±Ø§Øª 24 Ø³Ø§Ø¹ØªÙ‡"
}
```

---

## ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ API Ù‚ÛŒÙ…Øª

### 1. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Service

```typescript
// backend/price/price.controller.ts
import { silverPriceService } from './services/silver-price.service';

export async function getCurrentPrice(req, res) {
  try {
    const price = await silverPriceService.getCurrentPrice();
    res.json(price);
  } catch (error) {
    res.status(500).json({ error: 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª' });
  }
}
```

### 2. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Frontend

```typescript
import { LiveSilverPrice } from '../components/LiveSilverPrice';

function HomePage() {
  return (
    <div>
      <LiveSilverPrice />
      {/* ... */}
    </div>
  );
}
```

---

## Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ

### 1. ØªØ­Ù„ÛŒÙ„ ØªØµØ§ÙˆÛŒØ± Ù…Ø­ØµÙˆÙ„

```typescript
import { productAnalysisAI } from './ai/services/product-analysis.service';

const analysis = await productAnalysisAI.analyzeProductImage(
  'https://example.com/product.jpg'
);

if (!analysis.isAuthentic) {
  console.warn('Ù…Ø­ØµÙˆÙ„ Ù…Ø´Ú©ÙˆÚ©:', analysis.concerns);
}
```

### 2. Ú†Øªâ€ŒØ¨Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

```typescript
import { customerSupportAI } from './ai/services/customer-support.service';

const response = await customerSupportAI.handleCustomerQuery(
  'Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ù…Ø­ØµÙˆÙ„ Ø¨ÙØ±ÙˆØ´Ù…ØŸ',
  {
    userId: 'user123',
    history: [],
    metadata: { language: 'fa', userType: 'seller' },
  }
);

if (response.shouldEscalate) {
  // Ø§Ø±Ø¬Ø§Ø¹ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ
}
```

---

## PWA

### 1. ØªØ³Øª Manifest

```bash
# Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† DevTools
# Application > Manifest
```

### 2. Ù†ØµØ¨ Ø¨Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„

1. Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒØª Ø¯Ø± Chrome Ù…ÙˆØ¨Ø§ÛŒÙ„
2. Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ "Add to Home Screen"
3. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø§Ù†Ù†Ø¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù†ÛŒØªÛŒÙˆ

---

## ØªØ³Øª Ùˆ Ø±ÙØ¹ Ø¹ÛŒØ¨

### Ú†Ú© Ù„ÛŒØ³Øª ØªØ³Øª:

- [ ] ØªÙ…Ø§Ù… ØµÙØ­Ø§Øª Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- [ ] RTL/LTR Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³Ù‡ Ø²Ø¨Ø§Ù† Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Ù‚ÛŒÙ…Øª Ù†Ù‚Ø±Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- [ ] MFA Ø¯Ø± Login Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- [ ] Rate Limiting ÙØ¹Ø§Ù„ Ø§Ø³Øª
- [ ] Ú†Øªâ€ŒØ¨Ø§Øª AI Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- [ ] PWA Ù‚Ø§Ø¨Ù„ Ù†ØµØ¨ Ø§Ø³Øª

### ØªØ³Øª Performance:

```bash
# Lighthouse Score
npx lighthouse http://localhost:5173 --view

# Ù‡Ø¯Ù: Score > 90 Ø¯Ø± Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯
```

---

## Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬

### 1. Encryption Key Error

```bash
Error: ENCRYPTION_KEY environment variable is required
```

**Ø­Ù„:** ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ `.env`

### 2. OpenAI API Error

```bash
Error: Invalid API key
```

**Ø­Ù„:** Ø¨Ø±Ø±Ø³ÛŒ `OPENAI_API_KEY` Ø¯Ø± `.env`

### 3. i18n Not Loading

**Ø­Ù„:** Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø¯Ø± `public/locales/`

---

## Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ù…Ø´Ú©Ù„Ø§Øª:
- GitHub Issues: [https://github.com/Ya3er02/noghre-sod-ecommerce/issues](https://github.com/Ya3er02/noghre-sod-ecommerce/issues)
- Email: support@noghresood.shop
