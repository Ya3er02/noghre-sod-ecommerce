#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Check for secrets
echo "1Ô∏è‚É£ Checking for exposed secrets..."
if git diff --cached --name-only | grep -E "\.env$|\.env\.production$|\.env\.local$"; then
    echo "‚ùå ERROR: Attempting to commit environment files!"
    echo "   Remove them from staging with: git reset HEAD <file>"
    exit 1
fi

# Check for hardcoded passwords
echo "2Ô∏è‚É£ Scanning for hardcoded passwords..."
if git diff --cached | grep -i -E "password\s*=\s*['\"][^'\"]+['\"]" | grep -v "CHANGE_ME" | grep -v "your_password"; then
    echo "‚ö†Ô∏è  WARNING: Possible hardcoded password detected!"
    echo "   Please review your changes before committing."
fi

# Run type check on frontend if files changed
echo "3Ô∏è‚É£ Checking for TypeScript changes..."
if git diff --cached --name-only | grep -E "frontend/.*\.(ts|tsx)$" > /dev/null; then
    echo "   Running TypeScript type check..."
    cd frontend && bun run type-check
    if [ $? -ne 0 ]; then
        echo "‚ùå TypeScript errors found! Fix them before committing."
        exit 1
    fi
    cd ..
fi

echo "‚úÖ Pre-commit checks passed!"
